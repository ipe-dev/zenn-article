---
title: "„ÄêGo„ÄëEcho„Å®Nextjs„Çí‰Ωø„Å£„Å¶CORS„ÇíÂ≠¶„Çì„Åß„Åø„Åü"
emoji: "üòé"
type: "tech" # tech: ÊäÄË°ìË®ò‰∫ã / idea: „Ç¢„Ç§„Éá„Ç¢
topics: [Golang, CORS]
published: false
---
# „Åì„Çå„ÅØ‰Ωï
Go„ÅÆhttprouter„ÅÆ‰Ωø„ÅÑÊñπ„ÇíË¶ã„Å¶„ÅÑ„Åü„Çâ„ÄÅ`GlobalOPTIONS`„Å®„ÅÑ„ÅÜÂ§âÊï∞„Çí‰Ωø„Å£„Å¶preflight request„Å´ÂØæ„Åó„Å¶„Éò„ÉÉ„ÉÄ„Çí„Å§„Åë„Çâ„Çå„Çã„Åì„Å®„ÇíÁü•„Çä„Åæ„Åó„Åü„ÄÇ
„Åì„Çå„Çí‰Ωø„Å£„Å¶CORS„Å´Èñ¢„Åô„ÇãÁêÜËß£„ÇíÊ∑±„ÇÅ„Åü„ÅÑ„Å™„Éº„Å®ÊÄù„Å£„Åü„ÅÆ„ÅßË®ò‰∫ã„Å´„Åó„Åæ„Åô„ÄÇ
# „Åì„ÅÆË®ò‰∫ã„ÅÆ„Ç¥„Éº„É´
- echo„Éï„É¨„Éº„É†„ÉØ„Éº„ÇØ„Çí‰Ωø„Å£„Å¶CORS„ÅÆÁõÆÁöÑ„Å®‰ªïÁµÑ„Åø„ÇíÔºà„Åñ„Å£„Åè„ÇäÔºâÁêÜËß£„Åô„Çã
# ÁµêË´ñ
# CORS„Å´„Å§„ÅÑ„Å¶
CORS„ÅØ„Ç™„É™„Ç∏„É≥Èñì„É™„ÇΩ„Éº„ÇπÂÖ±ÊúâÔºàCross Origin Resource ShearingÔºâ„ÅÆÈ†≠ÊñáÂ≠ó„Çí„Å®„Å£„Åü„ÇÇ„ÅÆ„Åß„Åô„ÄÇ
Áï∞„Å™„Çã„Ç™„É™„Ç∏„É≥„Å´„ÅÇ„Çã„É™„ÇΩ„Éº„Çπ„Å´„Ç¢„ÇØ„Çª„Çπ„Åô„ÇãÈöõ„Å´„ÄÅ„Ç¢„ÇØ„Çª„Çπ„ÇíË®±ÂèØ„Åô„Çã„ÅãÂê¶„Åã„ÇíÊ±∫„ÇÅ„Çã‰ªïÁµÑ„Åø„Åß„Åô„ÄÇ
## „Ç™„É™„Ç∏„É≥„Å®„ÅØ
„Åù„ÇÇ„Åù„ÇÇ„Ç™„É™„Ç∏„É≥„Å®„ÅØ‰Ωï„Å™„ÅÆ„Åã„Å®„ÅÑ„ÅÜ„Å®
- „Çπ„Ç≠„Éº„É†
- „Éâ„É°„Ç§„É≥
- „Éù„Éº„Éà

„ÅÆ3„Å§„ÇíÂêà„Çè„Åõ„Åü„ÇÇ„ÅÆ„Çí„Ç™„É™„Ç∏„É≥„Å®„ÅÑ„ÅÑ„Åæ„Åô„ÄÇ
‰æã„Åà„Å∞„ÄÅ`http://example.com:80/hoge/fuga.html`„Å®„ÅÑ„ÅÜURL„Åå„ÅÇ„Å£„Åü„Å®„Åô„Çã„Å®„ÄÇ
http„Åå`„Çπ„Ç≠„Éº„É†`„ÄÅexample.com„Åå`„Éâ„É°„Ç§„É≥`„ÄÅ80„Åå`„Éù„Éº„Éà`„Åß„Åô„ÄÇ
`hoge/fuga.html`„ÅÆÈÉ®ÂàÜ„ÅØ„Éë„Çπ„Å™„ÅÆ„ÅßÈñ¢‰øÇ„Å™„ÅÑ„Åß„Åô„ÄÇ
## CORS„Çí‰Ωø„ÅÜÁõÆÁöÑ
CORS„Çí‰Ωø„ÅÜÁõÆÁöÑ„ÅØ„ÄÅÁï∞„Å™„Çã„Ç™„É™„Ç∏„É≥„Å´„ÅÇ„Çã„É™„ÇΩ„Éº„Çπ„Å´„Ç¢„ÇØ„Çª„Çπ„ÇíË®±ÂèØ„Åô„Çã„Åì„Å®„Åß„Åô„ÄÇ
„Å™„Åú„Çè„Åñ„Çè„ÅñË®±ÂèØ„Åô„Çã„ÅÆ„Åã„Å®„ÅÑ„ÅÜ„Å®„ÄÅ„É™„ÇΩ„Éº„Çπ„ÇíFetch„Åô„ÇãÊôÇ„Å´„ÅØ`Âêå‰∏Ä„Ç™„É™„Ç∏„É≥„Éù„É™„Ç∑„Éº`„Å®„ÅÑ„ÅÜ„Éù„É™„Ç∑„Éº„Åå„ÅÇ„Çã„Åü„ÇÅ„Åß„Åô„ÄÇ
### Âêå‰∏Ä„Ç™„É™„Ç∏„É≥„Éù„É™„Ç∑„Éº
Âêå‰∏Ä„Ç™„É™„Ç∏„É≥„Éù„É™„Ç∑„Éº„ÅØ„ÄÅ„Åù„ÅÆ„Åæ„Åæ„Åß„Åô„Åå„ÄÅÂêå„Åò„Ç™„É™„Ç∏„É≥„Åã„Çâ„ÅÆ„Ç¢„ÇØ„Çª„Çπ„ÅÆ„Åø„ÇíË®±ÂèØ„Åô„Çã‰ªïÁµÑ„Åø„Åß„Åô„ÄÇ
„Éá„Éï„Ç©„É´„Éà„Åß„Åì„ÅÆÁä∂ÊÖã„Å´„Å™„Å£„Å¶„ÅÑ„Çã„Åü„ÇÅ„ÄÅÁï∞„Å™„Çã„Ç™„É™„Ç∏„É≥„Åã„Çâ„ÅÆ„É™„ÇØ„Ç®„Çπ„Éà„ÇíË®±ÂèØ„Åó„Åü„ÅÑÂ†¥Âêà„Å´„ÅØCORS„Çí‰Ωø„ÅÜÂøÖË¶Å„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ
## „Éó„É™„Éï„É©„Ç§„Éà„É™„ÇØ„Ç®„Çπ„Éà
„É™„ÇØ„Ç®„Çπ„Éà„ÅÆÁ®ÆÈ°û„Å´„Çà„Å£„Å¶„ÅØ„ÄÅ„É™„ÇØ„Ç®„Çπ„Éà„ÇíÈÄÅ‰ø°„Åô„ÇãÂâç„Å´`„Éó„É™„Éï„É©„Ç§„Éà„É™„ÇØ„Ç®„Çπ„Éà`„Å®„ÅÑ„ÅÜ„É™„ÇØ„Ç®„Çπ„Éà„Åå„Éñ„É©„Ç¶„Ç∂„Å´„Çà„Å£„Å¶Ëá™ÂãïÁöÑ„Å´ÈÄÅ‰ø°„Åï„Çå„Çã„Åì„Å®„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ
„Éó„É™„Éï„É©„Ç§„Éà„É™„ÇØ„Ç®„Çπ„Éà„ÅØ`OPTIONS`„É°„ÇΩ„ÉÉ„Éâ„Çí‰Ωø„Å£„Åü„É™„ÇØ„Ç®„Çπ„Éà„Åß„ÄÅ„Çµ„Éº„Éê„Éº„ÅåCORS„Å´ÂØæÂøú„Åó„Å¶„ÅÑ„Çã„Åã„Å©„ÅÜ„Åã„ÇíÁ¢∫Ë™ç„Åó„Åæ„Åô„ÄÇ
„Åæ„Åü„ÄÅ[ÂçòÁ¥î„É™„ÇØ„Ç®„Çπ„Éà](https://developer.mozilla.org/ja/docs/Web/HTTP/CORS#%E5%8D%98%E7%B4%94%E3%83%AA%E3%82%AF%E3%82%A8%E3%82%B9%E3%83%88)„Å®Âëº„Å∞„Çå„Çã„É™„ÇØ„Ç®„Çπ„Éà„ÇíÈÄÅ„ÇãÂâç„Å´„ÅØ„Éó„É™„Éï„É©„Ç§„Éà„É™„ÇØ„Ç®„Çπ„Éà„ÅØÈÄÅ„Çâ„Çå„Åæ„Åõ„Çì„ÄÇ
# ÂÆüÈ®ì„Åó„Å¶„Åø„Çã
## echo
echo„ÅØGo„ÅÆWeb„Éï„É¨„Éº„É†„ÉØ„Éº„ÇØ„Åß„Åô„ÄÇ
Âü∫Êú¨ÁöÑ„Å™‰Ωø„ÅÑÊñπ„ÅØREADME„ÇíÂèÇÁÖß„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ
https://github.com/labstack/echo
‰ªäÂõû„ÅØecho„ÅÆ„Éü„Éâ„É´„Ç¶„Çß„Ç¢Ê©üËÉΩ„Çí‰Ωø„Å£„Å¶CORS„ÇíÂÆüÁèæ„Åó„Åü„ÅÑ„Å®ÊÄù„ÅÑ„Åæ„Åô„ÄÇ
https://echo.labstack.com/docs/middleware/cors
## „Éê„ÉÉ„ÇØ„Ç®„É≥„Éâ„ÅÆÂÆüË£Ö
‰ª•‰∏ã„Åå„Éê„ÉÉ„ÇØ„Ç®„É≥„Éâ„ÅÆÂÆüË£Ö‰æã„Åß„Åô„ÄÇ
```go
type PostRequest struct {
	Name string `json:"name"`
}

func getHello(c echo.Context) error {
	return c.JSON(http.StatusOK, map[string]string{"message": "get hello world"})
}

func postHello(c echo.Context) error {
	r := new(PostRequest)
	if err := c.Bind(r); err != nil {
		return err
	}
	fmt.Println(r)
	return c.JSON(http.StatusOK, map[string]string{"message": fmt.Sprintf("%s hello world", r.Name)})
}

func main() {
	e := echo.New()
	// „Éü„Éâ„É´„Ç¶„Çß„Ç¢„Çí‰Ωø„Å£„Å¶CORS„ÅÆË®≠ÂÆö„Çí„Åô„Çã
	e.Use(middleware.CORSWithConfig(middleware.CORSConfig{
		// http://example.com„ÅÆ„Ç™„É™„Ç∏„É≥„ÅÆ„Åø„ÇíË®±ÂèØ
		AllowOrigins: []string{"http://example.com"},
		// Oigin,ContentType,Accept„ÅÆ„Éò„ÉÉ„ÉÄ„ÇíË®±ÂèØ
		AllowHeaders: []string{echo.HeaderOrigin, echo.HeaderContentType, echo.HeaderAccept},
	}))
	e.GET("/getHello", getHello)
	e.POST("/postHello", postHello)
	e.Logger.Fatal(e.Start(":8090"))
}
```
„Åæ„Åö„ÄÅ`getHello`„Å®`postHello`„Å®„ÅÑ„ÅÜ„Éè„É≥„Éâ„É©„ÇíÁî®ÊÑè„Åó„Åæ„Åó„Åü„ÄÇ
„Åù„Çå„Åû„Çå„ÄÅ`/getHello`„Å®`/postHello`„Å´GET„Å®POST„Åß„Ç¢„ÇØ„Çª„Çπ„Åó„Åü„Å®„Åç„ÅÆ„Éè„É≥„Éâ„É©„Å´„Å™„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇ
CORS„ÇíË®≠ÂÆö„Åó„Å¶„ÅÑ„Çã„ÅÆ„ÅØ`Use`„Å®„ÅÑ„ÅÜ„É°„ÇΩ„ÉÉ„Éâ„Çí‰Ωø„Å£„Å¶„ÅÑ„ÇãÈÉ®ÂàÜ„Åß„Åô„ÄÇ
`http://example.com`„Å®„ÅÑ„ÅÜ„Ç™„É™„Ç∏„É≥„ÅÆ„Åø„ÇíË®±ÂèØ„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ
„Åæ„Åü„ÄÅ`e.Use(middleware.CORS())`„Å®„Åô„Çã„Å®echoÂÅ¥„ÅßÁî®ÊÑè„Åï„Çå„Åü„Éá„Éï„Ç©„É´„Éà„ÅÆË®≠ÂÆö„Å®„Å™„Çä„ÄÅ„Å©„Çì„Å™„Ç™„É™„Ç∏„É≥„Åã„Çâ„ÅÆ„Ç¢„ÇØ„Çª„Çπ„ÇÇË®±ÂèØ„Åô„Çã„Çà„ÅÜ„Å´„Å™„Çä„Åæ„Åô„ÄÇ
## „Éï„É≠„É≥„Éà„Ç®„É≥„Éâ„ÅÆÂÆüË£Ö
Á∂ö„ÅÑ„Å¶„Éï„É≠„É≥„Éà„Ç®„É≥„Éâ„ÅÆÂÆüË£Ö‰æã„Åß„Åô„ÄÇ
‰ªäÂõû„ÅØNext.js„ÅÆ`fetch`„Çí‰Ωø„Å£„Å¶API„ÇíÂÆüË°å„Åó„Åæ„Åô„ÄÇ
```tsx:pages/CorsTest/index.tsx
const getFromEcho = async () => {
    const response = await fetch("http://localhost:8090/getHello")
    return response 
    
}
const postToEcho = async () => {
    const name = "taro"
    const response = await fetch("http://localhost:8090/postHello", {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
        },
        body: JSON.stringify({ name: name })
    })
    return response
}
const CorsTest = () => {
    const response = getFromEcho()
    
    return (
        <>
            <h1>CORS Test Page</h1>
        </>
    )
}
```
`getFromEcho`„Å®`postToEcho`„Åå„Åù„Çå„Åû„Çå„Çµ„Éº„Éê„Éº„Å∏„ÅÆGET„Å®POST„Å´ÂØæÂøú„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ
`pages/CorsTest/index.tsx`„Å®„ÅÑ„ÅÜ„Éë„Çπ„Åß„Éï„Ç°„Ç§„É´„Çí‰ΩúÊàê„Åó„Åü„ÅÆ„Åß„ÄÅ`localhost:3000/CorsTest`„Å´„Ç¢„ÇØ„Çª„Çπ„Åô„Çã„Å®ÁîªÈù¢„ÅåË°®Á§∫„Åï„Çå„Å¶„Éê„ÉÉ„ÇØ„Ç®„É≥„Éâ„Çµ„Éº„Éê„Éº„Å´„É™„ÇØ„Ç®„Çπ„Éà„ÅåÈÄÅ‰ø°„Åï„Çå„Åæ„Åô„ÄÇ
## GET
`localhost:3000/CorsTest`„Å´„Ç¢„ÇØ„Çª„Çπ„Åó„ÄÅ„Éá„Éô„É≠„ÉÉ„Éë„Éº„ÉÑ„Éº„É´„ÅÆ„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ„ÇíË¶ã„Å¶„Åø„Çã„Å®‰ª•‰∏ã„ÅÆ„Çà„ÅÜ„Å™„É¨„Çπ„Éù„É≥„Çπ„ÅåËøî„Å£„Å¶„Åç„Å¶„ÅÑ„Åæ„Åô„ÄÇ
![](/images/image20240325_1.png)
`http://localhost:3000`„Åã„Çâ„ÅÆ„Ç¢„ÇØ„Çª„Çπ„ÅØË®±ÂèØ„Åó„Å¶„ÅÑ„Å™„ÅÑ„ÅÆ„ÅßCORS„Ç®„É©„Éº„Å´„Å™„Çä„Åæ„Åó„Åü„ÄÇ
### Ë®±ÂèØ„Åó„Å¶„Åø„Çã
```go
func main() {
	e := echo.New()
	e.Use(middleware.CORSWithConfig(middleware.CORSConfig{
		// http://localhost:3000„ÇíË®±ÂèØ
		AllowOrigins: []string{"http://localhost:3000"},
		AllowHeaders: []string{echo.HeaderOrigin, echo.HeaderContentType, echo.HeaderAccept },
	}))
	e.GET("/getHello", getHello)
	e.POST("/postHello", postHello)
	e.DELETE("/deleteHello", deleteHello)
	e.Logger.Fatal(e.Start(":8090"))
}
```
`AllowOrigins`„ÅÆÈÉ®ÂàÜ„Çí`http://localhost:3000`„ÇíË®±ÂèØ„Åô„Çã„Çà„ÅÜ„Å´Â§â„Åà„Åæ„Åó„Åü„ÄÇ
„Åì„Çå„Åß„É™„ÇØ„Ç®„Çπ„Éà„Åô„Çã„Å®Ê≠£Â∏∏„Å™„É¨„Çπ„Éù„É≥„Çπ„ÅåËøî„Å£„Å¶„Åç„Åæ„Åó„Åü„ÄÇ
![](/images/image2024032601.png)
## POST
Ê¨°„Å´POST„ÇíË©¶„Åó„Å¶„Åø„Åæ„Åô„ÄÇ
„Éï„É≠„É≥„Éà„Ç®„É≥„Éâ„Å®„Éê„ÉÉ„ÇØ„Ç®„É≥„Éâ„ÅÆ„Ç≥„Éº„Éâ„ÇíÂ∞ë„ÅóÂ§âÊõ¥„Åó„Åæ„Åô„ÄÇ
```tsx:pages/CorsTest/index.tsx
const CorsTest = () => {
    const response = postToEcho() // post„Å´Â§âÊõ¥
    
    return (
        <>
            <h1>CORS Test Page</h1>
        </>
    )
}
```
```go
	e.Use(middleware.CORSWithConfig(middleware.CORSConfig{
		AllowOrigins: []string{"http://example.com"},
		AllowHeaders: []string{echo.HeaderOrigin, echo.HeaderContentType, echo.HeaderAccept, "X-hoge"},
	}))
```
